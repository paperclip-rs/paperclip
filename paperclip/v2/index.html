<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities related to the OpenAPI v2 specification."><title>paperclip::v2 - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-405f8b29f52305f8.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="paperclip" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-nightly (0ee7cb5e3 2024-09-10)" data-channel="nightly" data-search-js="search-0cfde64e8ad3a7fe.js" data-settings-js="settings-7e3bb6c46e92e77c.js" ><script src="../../static.files/storage-29b1d5a9048d38fe.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-14659ec02b58af51.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-40f72c9259523cb3.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../paperclip/index.html">paperclip</a><span class="version">0.9.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module v2</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#detailed-example" title="Detailed example">Detailed example</a></li></ul><h3><a href="#reexports">Module Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate paperclip</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">paperclip</a>::<wbr><a class="mod" href="#">v2</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/paperclip/v2/mod.rs.html#1-135">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities related to the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md">OpenAPI v2 specification</a>.</p>
<h2 id="detailed-example"><a class="doc-anchor" href="#detailed-example">§</a>Detailed example</h2>
<p>To parse your v2 spec, you begin with transforming the schema into a
Rust struct. If your schema doesn’t have custom properties, then you
can use the <code>DefaultSchema</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>paperclip::v2::{<span class="self">self</span>, ResolvableApi, DefaultSchema, models::Version};

<span class="kw">use </span>std::fs::File;

<span class="kw">let </span><span class="kw-2">mut </span>fd = File::open(<span class="string">"my_spec.yaml"</span>).unwrap(); <span class="comment">// yaml or json
</span><span class="kw">let </span>api: ResolvableApi&lt;DefaultSchema&gt; = v2::from_reader(<span class="kw-2">&amp;mut </span>fd).unwrap();
<span class="macro">assert_eq!</span>(api.swagger, Version::V2);</code></pre></div>
<p>On the other hand, if your schema does have custom properties which you’d
like to parse, then use the <code>#[api_v2_schema]</code> proc macro.</p>
<p>For example, let’s take the <a href="https://github.com/kubernetes/kubernetes/tree/afd928b8bc81cea385eba4c94558373df7aeae75/api/openapi-spec">Kubernetes API spec</a>
which uses some custom thingmabobs. Let’s say we’re only interested in the
<code>x-kubernetes-patch-strategy</code> field for now.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[macro_use] </span><span class="kw">extern crate </span>serde_derive; <span class="comment">// NOTE: We're using serde for decoding stuff.

</span><span class="kw">use </span>paperclip::v2::{<span class="self">self</span>, ResolvableApi};

<span class="kw">use </span>std::fs::File;

<span class="attr">#[derive(Debug, Deserialize)]
#[serde(rename_all = <span class="string">"camelCase"</span>)]
</span><span class="kw">enum </span>PatchStrategy {
    Merge,
    RetainKeys,
    <span class="attr">#[serde(rename = <span class="string">"merge,retainKeys"</span>)]
    </span>MergeAndRetain,
    <span class="attr">#[serde(other)]
    </span>Other,
}

<span class="attr">#[paperclip::api_v2_schema]
#[derive(Debug, Deserialize)]
</span><span class="kw">struct </span>K8sSchema {
    <span class="attr">#[serde(rename = <span class="string">"x-kubernetes-patch-strategy"</span>)]
    </span>patch_strategy: <span class="prelude-ty">Option</span>&lt;PatchStrategy&gt;,
}

<span class="comment">// K8sSchema now implements `Schema` trait.
</span><span class="kw">let </span><span class="kw-2">mut </span>fd = File::open(<span class="string">"k8s_spec.yaml"</span>).unwrap();
<span class="kw">let </span>api: ResolvableApi&lt;K8sSchema&gt; = v2::from_reader(<span class="kw-2">&amp;mut </span>fd).unwrap();</code></pre></div>
<p>Now, if <code>codegen</code> feature is enabled (it is by default), we can use the
emitter to emit the API into some path. But first, we need to resolve the
raw schema. During resolution, we:</p>
<ul>
<li>walk through the nodes, find <code>$ref</code> fields and assign references to
the actual definitions.</li>
<li>identify anonymous definitions in body parameters and response schemas
and add them to the known map of definitions.</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[cfg(feature = <span class="string">"codegen"</span>)] </span>{

<span class="kw">let </span>resolved = api.resolve().unwrap();
}</code></pre></div>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[cfg(feature = <span class="string">"codegen"</span>)] </span>{
<span class="kw">use </span>paperclip::v2::{DefaultEmitter, EmitterState, Emitter};

<span class="kw">let </span><span class="kw-2">mut </span>state = EmitterState::default();
state.working_dir = <span class="string">"/path/to/my/crate"</span>.into();
<span class="kw">let </span>emitter = DefaultEmitter::from(state);
emitter.generate(<span class="kw-2">&amp;</span>api).unwrap(); <span class="comment">// generate code!
</span>}</code></pre></div>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.DefaultEmitter"><code>pub use self::codegen::<a class="struct" href="codegen/struct.DefaultEmitter.html" title="struct paperclip::v2::codegen::DefaultEmitter">DefaultEmitter</a>;</code></div></li><li><div class="item-name" id="reexport.Emitter"><code>pub use self::codegen::<a class="trait" href="codegen/trait.Emitter.html" title="trait paperclip::v2::codegen::Emitter">Emitter</a>;</code></div></li><li><div class="item-name" id="reexport.EmitterState"><code>pub use self::codegen::<a class="struct" href="codegen/struct.EmitterState.html" title="struct paperclip::v2::codegen::EmitterState">EmitterState</a>;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="codegen/index.html" title="mod paperclip::v2::codegen">codegen</a></div><div class="desc docblock-short">Code generation for OpenAPI v2.</div></li><li><div class="item-name"><a class="mod" href="im/index.html" title="mod paperclip::v2::im">im</a></div><div class="desc docblock-short">Interior mutability stuff.</div></li><li><div class="item-name"><a class="mod" href="models/index.html" title="mod paperclip::v2::models">models</a></div><div class="desc docblock-short">Models used by OpenAPI v2.</div></li><li><div class="item-name"><a class="mod" href="schema/index.html" title="mod paperclip::v2::schema">schema</a></div><div class="desc docblock-short">Traits used for code and spec generation.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DefaultSchema.html" title="struct paperclip::v2::DefaultSchema">Default<wbr>Schema</a></div><div class="desc docblock-short">Default schema if your schema doesn’t have any custom fields.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.Schema.html" title="trait paperclip::v2::Schema">Schema</a></div><div class="desc docblock-short">Interface for the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#schemaObject"><code>Schema</code></a> object.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.from_reader.html" title="fn paperclip::v2::from_reader">from_<wbr>reader</a></div><div class="desc docblock-short">Deserialize the schema from the given reader. Currently, this only supports
JSON and YAML formats.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.ResolvableApi.html" title="type paperclip::v2::ResolvableApi">Resolvable<wbr>Api</a></div><div class="desc docblock-short">OpenAPI v2 spec which can be traversed and resolved for codegen.</div></li></ul></section></div></main></body></html>