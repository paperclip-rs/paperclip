<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Utilities related to the OpenAPI v2 specification."><meta name="keywords" content="rust, rustlang, rust-lang, v2"><title>paperclip::v2 - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../paperclip/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../paperclip/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module v2</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="v2" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../paperclip/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../index.html">paperclip</a>::<wbr><a class="mod" href="#">v2</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/paperclip/v2/mod.rs.html#1-134">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Utilities related to the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md">OpenAPI v2 specification</a>.</p>
<h2 id="detailed-example"><a href="#detailed-example">Detailed example</a></h2>
<p>To parse your v2 spec, you begin with transforming the schema into a
Rust struct. If your schema doesn’t have custom properties, then you
can use the <code>DefaultSchema</code>.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">paperclip::v2</span>::{<span class="self">self</span>, <span class="ident">ResolvableApi</span>, <span class="ident">DefaultSchema</span>, <span class="ident">models::Version</span>};

<span class="kw">use</span> <span class="ident">std::fs::File</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">fd</span> <span class="op">=</span> <span class="ident">File::open</span>(<span class="string">&quot;my_spec.yaml&quot;</span>).<span class="ident">unwrap</span>(); <span class="comment">// yaml or json</span>
<span class="kw">let</span> <span class="ident">api</span>: <span class="ident">ResolvableApi</span><span class="op">&lt;</span><span class="ident">DefaultSchema</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v2::from_reader</span>(<span class="kw-2">&amp;mut</span> <span class="ident">fd</span>).<span class="ident">unwrap</span>();
<span class="macro">assert_eq!</span>(<span class="ident">api</span>.<span class="ident">swagger</span>, <span class="ident">Version::V2</span>);</code></pre></div>
<p>On the other hand, if your schema does have custom properties which you’d
like to parse, then use the <code>#[api_v2_schema]</code> proc macro.</p>
<p>For example, let’s take the <a href="https://github.com/kubernetes/kubernetes/tree/afd928b8bc81cea385eba4c94558373df7aeae75/api/openapi-spec">Kubernetes API spec</a>
which uses some custom thingmabobs. Let’s say we’re only interested in the
<code>x-kubernetes-patch-strategy</code> field for now.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">macro_use</span>]</span> <span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">serde_derive</span>; <span class="comment">// NOTE: We&#39;re using serde for decoding stuff.</span>

<span class="kw">use</span> <span class="ident">paperclip::v2</span>::{<span class="self">self</span>, <span class="ident">ResolvableApi</span>};

<span class="kw">use</span> <span class="ident">std::fs::File</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>, <span class="ident">Deserialize</span>)]</span>
<span class="attribute">#[<span class="ident">serde</span>(<span class="ident">rename_all</span> <span class="op">=</span> <span class="string">&quot;camelCase&quot;</span>)]</span>
<span class="kw">enum</span> <span class="ident">PatchStrategy</span> {
    <span class="ident">Merge</span>,
    <span class="ident">RetainKeys</span>,
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">rename</span> <span class="op">=</span> <span class="string">&quot;merge,retainKeys&quot;</span>)]</span>
    <span class="ident">MergeAndRetain</span>,
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">other</span>)]</span>
    <span class="ident">Other</span>,
}

<span class="attribute">#[<span class="ident">paperclip::api_v2_schema</span>]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>, <span class="ident">Deserialize</span>)]</span>
<span class="kw">struct</span> <span class="ident">K8sSchema</span> {
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">rename</span> <span class="op">=</span> <span class="string">&quot;x-kubernetes-patch-strategy&quot;</span>)]</span>
    <span class="ident">patch_strategy</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">PatchStrategy</span><span class="op">&gt;</span>,
}

<span class="comment">// K8sSchema now implements `Schema` trait.</span>
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">fd</span> <span class="op">=</span> <span class="ident">File::open</span>(<span class="string">&quot;k8s_spec.yaml&quot;</span>).<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">api</span>: <span class="ident">ResolvableApi</span><span class="op">&lt;</span><span class="ident">K8sSchema</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">v2::from_reader</span>(<span class="kw-2">&amp;mut</span> <span class="ident">fd</span>).<span class="ident">unwrap</span>();</code></pre></div>
<p>Now, if <code>codegen</code> feature is enabled (it is by default), we can use the
emitter to emit the API into some path. But first, we need to resolve the
raw schema. During resolution, we:</p>
<ul>
<li>walk through the nodes, find <code>$ref</code> fields and assign references to
the actual definitions.</li>
<li>identify anonymous definitions in body parameters and response schemas
and add them to the known map of definitions.</li>
</ul>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;codegen&quot;</span>)]</span> {

<span class="kw">let</span> <span class="ident">resolved</span> <span class="op">=</span> <span class="ident">api</span>.<span class="ident">resolve</span>().<span class="ident">unwrap</span>();
}</code></pre></div>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;codegen&quot;</span>)]</span> {
<span class="kw">use</span> <span class="ident">paperclip::v2</span>::{<span class="ident">DefaultEmitter</span>, <span class="ident">EmitterState</span>, <span class="ident">Emitter</span>};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">state</span> <span class="op">=</span> <span class="ident">EmitterState::default</span>();
<span class="ident">state</span>.<span class="ident">working_dir</span> <span class="op">=</span> <span class="string">&quot;/path/to/my/crate&quot;</span>.<span class="ident">into</span>();
<span class="kw">let</span> <span class="ident">emitter</span> <span class="op">=</span> <span class="ident">DefaultEmitter::from</span>(<span class="ident">state</span>);
<span class="ident">emitter</span>.<span class="ident">generate</span>(<span class="kw-2">&amp;</span><span class="ident">api</span>).<span class="ident">unwrap</span>(); <span class="comment">// generate code!</span>
}</code></pre></div>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.DefaultEmitter"><code>pub use self::codegen::<a class="struct" href="codegen/struct.DefaultEmitter.html" title="struct paperclip::v2::codegen::DefaultEmitter">DefaultEmitter</a>;</code></div><div class="item-right docblock-short"></div></div></div><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="codegen/index.html" title="paperclip::v2::codegen mod">codegen</a></div><div class="item-right docblock-short"><p>Code generation for OpenAPI v2.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="im/index.html" title="paperclip::v2::im mod">im</a></div><div class="item-right docblock-short"><p>Interior mutability stuff.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="models/index.html" title="paperclip::v2::models mod">models</a></div><div class="item-right docblock-short"><p>Models used by OpenAPI v2.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="schema/index.html" title="paperclip::v2::schema mod">schema</a></div><div class="item-right docblock-short"><p>Traits used for code and spec generation.</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DefaultSchema.html" title="paperclip::v2::DefaultSchema struct">DefaultSchema</a></div><div class="item-right docblock-short"><p>Default schema if your schema doesn’t have any custom fields.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EmitterState.html" title="paperclip::v2::EmitterState struct">EmitterState</a></div><div class="item-right docblock-short"><p>Holds the state for your schema emitter.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Emitter.html" title="paperclip::v2::Emitter trait">Emitter</a></div><div class="item-right docblock-short"><p><code>Emitter</code> represents the interface for generating the relevant
modules, API object definitions and the associated calls.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Schema.html" title="paperclip::v2::Schema trait">Schema</a></div><div class="item-right docblock-short"><p>Interface for the <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#schemaObject"><code>Schema</code></a> object.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.from_reader.html" title="paperclip::v2::from_reader fn">from_reader</a></div><div class="item-right docblock-short"><p>Deserialize the schema from the given reader. Currently, this only supports
JSON and YAML formats.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.ResolvableApi.html" title="paperclip::v2::ResolvableApi type">ResolvableApi</a></div><div class="item-right docblock-short"><p>OpenAPI v2 spec which can be traversed and resolved for codegen.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="paperclip" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0-nightly (c35035cef 2022-05-30)" ></div>
</body></html>